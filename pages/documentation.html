<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="icon" type="image/avif" href="../assets/img/FavIcon.avif">
  <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/FavIcon.avif">
  <title>API Documentation - Uqudo Admin Portal</title>

  <!-- Authentication & URL Protection -->
  <script>
    // Block direct .html access - redirect to clean URLs
    (function() {
      if (window.location.pathname.endsWith('.html')) {
        const cleanPath = window.location.pathname.replace('.html', '');
        window.location.replace(cleanPath + window.location.search + window.location.hash);
        return; // Stop execution after redirect
      }

      // Check authentication before page loads
      const authToken = localStorage.getItem('uqudo_token') || localStorage.getItem('auth_token');
      if (!authToken) {
        window.location.replace('/pages/uqudo-sign-in');
      }
    })();
  </script>

  <!-- Fonts and icons -->
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700,900" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">

  <!-- Material Dashboard CSS -->
  <link id="pagestyle" href="../assets/css/material-dashboard.css?v=3.2.0" rel="stylesheet" />
  <link href="../assets/css/uqudo-blue-theme.css" rel="stylesheet" />
  <link href="../assets/css/dark-mode.css" rel="stylesheet" />

  <!-- Marked.js for Markdown rendering -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- Highlight.js for code syntax highlighting -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

  <style>
    /* Documentation Navigation Tabs */
    .doc-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      border-bottom: 2px solid #e9ecef;
      padding-bottom: 0;
    }
    .doc-tab {
      padding: 0.75rem 1.5rem;
      border: none;
      background: transparent;
      color: #67748e;
      font-weight: 500;
      font-size: 0.95rem;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      margin-bottom: -2px;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .doc-tab:hover {
      color: #1A73E8;
      background: rgba(26, 115, 232, 0.05);
    }
    .doc-tab.active {
      color: #1A73E8;
      border-bottom-color: #1A73E8;
      font-weight: 600;
    }
    .doc-tab i {
      font-size: 1.25rem;
    }

    .markdown-content {
      font-family: 'Inter', sans-serif;
      line-height: 1.6;
      color: #344767;
    }
    .markdown-content h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-top: 2rem;
      margin-bottom: 1rem;
      color: #344767;
      border-bottom: 2px solid #e9ecef;
      padding-bottom: 0.5rem;
    }
    .markdown-content h2 {
      font-size: 2rem;
      font-weight: 600;
      margin-top: 2rem;
      margin-bottom: 1rem;
      color: #344767;
    }
    .markdown-content h3 {
      font-size: 1.5rem;
      font-weight: 600;
      margin-top: 1.5rem;
      margin-bottom: 0.75rem;
      color: #344767;
    }
    .markdown-content h4 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-top: 1rem;
      margin-bottom: 0.5rem;
      color: #344767;
    }
    .markdown-content pre {
      background-color: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 0.5rem;
      padding: 1rem;
      overflow-x: auto;
      margin: 1rem 0;
    }
    .markdown-content code {
      background-color: #f8f9fa;
      color: #d63384;
      padding: 0.2rem 0.4rem;
      border-radius: 0.25rem;
      font-size: 0.875rem;
      font-family: 'Courier New', monospace;
    }
    .markdown-content pre code {
      background-color: transparent;
      color: inherit;
      padding: 0;
    }
    .markdown-content table {
      width: 100%;
      margin: 1rem 0;
      border-collapse: collapse;
    }
    .markdown-content table th,
    .markdown-content table td {
      border: 1px solid #dee2e6;
      padding: 0.75rem;
      text-align: left;
    }
    .markdown-content table th {
      background-color: #f8f9fa;
      font-weight: 600;
    }
    .markdown-content a {
      color: #1A73E8;
      text-decoration: none;
    }
    .markdown-content a:hover {
      text-decoration: underline;
    }
    .markdown-content blockquote {
      border-left: 4px solid #1A73E8;
      padding-left: 1rem;
      margin-left: 0;
      color: #67748e;
      font-style: italic;
    }
    .markdown-content ul, .markdown-content ol {
      margin: 1rem 0;
      padding-left: 2rem;
    }
    .markdown-content li {
      margin: 0.5rem 0;
    }
    .loading-spinner {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 400px;
    }
    .back-to-top {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(195deg, #1A73E8 0%, #004C97 100%);
      color: white;
      border: none;
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      z-index: 1000;
    }
    .back-to-top:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
    }
    .toc {
      background: #f8f9fa;
      border-radius: 0.75rem;
      padding: 1.5rem;
      margin-bottom: 2rem;
      position: sticky;
      top: 1rem;
    }
    .toc h3 {
      margin-top: 0 !important;
      font-size: 1.25rem;
    }
    .toc ul {
      list-style: none;
      padding-left: 1rem;
    }
    .toc a {
      color: #344767;
      font-size: 0.9rem;
    }
  </style>
</head>

<body class="g-sidenav-show bg-gray-200">
  <!-- Sidebar -->
  <aside class="sidenav navbar navbar-vertical navbar-expand-xs border-radius-lg fixed-start ms-2 bg-white my-2" id="sidenav-main">
    <div class="sidenav-header" style="height: 112px;">
      <i class="fas fa-times p-3 cursor-pointer text-dark opacity-5 position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true" id="iconSidenav"></i>
      <a class="navbar-brand m-0 p-0 d-block w-100 h-100 d-flex align-items-center" href="uqudo-dashboard">
        <img src="../assets/img/uqudo-logo.svg" alt="Uqudo Logo" style="width: 100%; height: auto; display: block;">
      </a>
    </div>
    <hr class="horizontal dark mt-0 mb-2">
    <div class="collapse navbar-collapse w-auto" id="sidenav-collapse-main">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link text-dark" href="uqudo-dashboard">
            <i class="material-symbols-rounded opacity-10">dashboard</i>
            <span class="nav-link-text ms-1">Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="accounts">
            <i class="material-symbols-rounded opacity-10">person</i>
            <span class="nav-link-text ms-1">Accounts</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="alerts">
            <i class="material-symbols-rounded opacity-10">notification_important</i>
            <span class="nav-link-text ms-1">KYC Alerts</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="cases">
            <i class="material-symbols-rounded opacity-10">gavel</i>
            <span class="nav-link-text ms-1">AML Cases</span>
        </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="./uqudo-analytics">
            <i class="material-symbols-rounded opacity-10">analytics</i>
            <span class="nav-link-text ms-1">Uqudo Analytics</span>
          </a>
        </li>
        <li class="nav-item mt-3">
          <h6 class="ps-4 ms-2 text-uppercase text-xs text-dark font-weight-bolder opacity-8">Configuration</h6>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="kyc-setup">
            <i class="material-symbols-rounded opacity-10">settings</i>
            <span class="nav-link-text ms-1">KYC Setup</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="blocklist">
            <i class="material-symbols-rounded opacity-10">block</i>
            <span class="nav-link-text ms-1">Blocklist</span>
          </a>
        </li>
        <li class="nav-item mt-3">
          <h6 class="ps-4 ms-2 text-uppercase text-xs text-dark font-weight-bolder opacity-8">Administration</h6>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="user-access">
            <i class="material-symbols-rounded opacity-10">admin_panel_settings</i>
            <span class="nav-link-text ms-1">User Access</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-dark" href="security-settings">
            <i class="material-symbols-rounded opacity-10">security</i>
            <span class="nav-link-text ms-1">Security Settings</span>
          </a>
        </li>
      </ul>
    </div>
    <div class="sidenav-footer position-absolute w-100 bottom-0">
      <div class="mx-3">
        <a class="btn btn-outline-info mt-4 w-100 active" href="documentation">
          <i class="material-symbols-rounded text-sm me-1">description</i>
          Documentation
        </a>
        <a class="btn bg-gradient-info w-100 mt-2" href="#" id="logout-btn">
          <i class="material-symbols-rounded text-sm me-1">logout</i>
          Logout
        </a>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg">
    <!-- Navbar -->
    <nav class="navbar navbar-main navbar-expand-lg px-0 mx-3 shadow-none border-radius-xl">
      <div class="container-fluid py-1 px-3">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
            <li class="breadcrumb-item text-sm"><a class="opacity-5 text-dark" href="javascript:;">Pages</a></li>
            <li class="breadcrumb-item text-sm text-dark active" aria-current="page">Documentation</li>
          </ol>
          <h6 class="font-weight-bolder mb-0">API Documentation</h6>
        </nav>
        <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
          <div class="ms-md-auto pe-md-3 d-flex align-items-center"></div>
          <ul class="navbar-nav justify-content-end align-items-center">
            <li class="nav-item d-flex align-items-center me-2">
              <button class="theme-toggle" onclick="toggleTheme()" title="Toggle dark mode" aria-label="Toggle dark mode">
                <span class="material-symbols-rounded icon-sun">light_mode</span>
                <span class="material-symbols-rounded icon-moon">dark_mode</span>
              </button>
            </li>
            <li class="nav-item d-flex align-items-center">
              <a href="#" class="nav-link text-body font-weight-bold px-0">
                <i class="material-symbols-rounded">account_circle</i>
                <span class="d-sm-inline d-none ms-1" id="user-name">User</span>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Documentation Content -->
    <div class="container-fluid py-2">
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-body">
              <!-- Documentation Tabs -->
              <div class="doc-tabs">
                <button class="doc-tab active" data-doc="api">
                  <i class="material-symbols-rounded">api</i>
                  API Documentation
                </button>
                <button class="doc-tab" data-doc="sdk-analytics">
                  <i class="material-symbols-rounded">analytics</i>
                  SDK Analytics Integration
                </button>
              </div>

              <!-- Loading Spinner -->
              <div id="loading" class="loading-spinner">
                <div class="spinner-border text-info" role="status">
                  <span class="visually-hidden">Loading documentation...</span>
                </div>
              </div>

              <!-- Documentation Content Containers -->
              <div id="doc-api" class="markdown-content" style="display: none;"></div>
              <div id="doc-sdk-analytics" class="markdown-content" style="display: none;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Back to Top Button -->
  <button class="back-to-top" id="backToTop">
    <i class="material-symbols-rounded">arrow_upward</i>
  </button>

  <!-- Core JS Files -->
  <script src="../assets/js/core/popper.min.js"></script>
  <script src="../assets/js/core/bootstrap.min.js"></script>
  <script src="../assets/js/plugins/perfect-scrollbar.min.js"></script>
  <script src="../assets/js/material-dashboard.min.js?v=3.2.0"></script>
  <script src="../assets/js/api-client.js"></script>

  <script>
    // api is already defined globally in api-client.js

    // Configure marked with options
    marked.setOptions({
      highlight: function(code, lang) {
        if (lang && hljs.getLanguage(lang)) {
          return hljs.highlight(code, { language: lang }).value;
        }
        return hljs.highlightAuto(code).value;
      },
      breaks: true,
      gfm: true
    });

    // Documentation sources
    const docSources = {
      'api': '../assets/API_DOCUMENTATION.md',
      'sdk-analytics': '../assets/SDK_ANALYTICS_INTEGRATION_GUIDE.md'
    };

    // Cache for loaded docs
    const docCache = {};

    // Current active doc
    let activeDoc = 'api';

    // Load and render a specific documentation
    async function loadDoc(docKey) {
      const container = document.getElementById(`doc-${docKey}`);
      const loadingEl = document.getElementById('loading');

      // If already loaded, just show it
      if (docCache[docKey]) {
        showDoc(docKey);
        return;
      }

      // Show loading
      loadingEl.style.display = 'flex';
      container.style.display = 'none';

      try {
        const response = await fetch(docSources[docKey]);
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        const markdown = await response.text();

        const html = marked.parse(markdown);
        container.innerHTML = html;
        docCache[docKey] = true;

        // Highlight code blocks
        container.querySelectorAll('pre code').forEach((block) => {
          hljs.highlightElement(block);
        });

        // Smooth scroll for anchor links
        container.querySelectorAll('a[href^="#"]').forEach(anchor => {
          anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = container.querySelector(this.getAttribute('href'));
            if (target) {
              target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          });
        });

        showDoc(docKey);
      } catch (error) {
        loadingEl.innerHTML = `
          <div class="alert alert-danger" role="alert">
            <strong>Error loading documentation:</strong> ${error.message}
          </div>
        `;
      }
    }

    // Show a specific documentation and hide others
    function showDoc(docKey) {
      const loadingEl = document.getElementById('loading');
      loadingEl.style.display = 'none';

      // Hide all doc containers
      Object.keys(docSources).forEach(key => {
        const container = document.getElementById(`doc-${key}`);
        container.style.display = key === docKey ? 'block' : 'none';
      });

      // Update tab states
      document.querySelectorAll('.doc-tab').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.doc === docKey);
      });

      activeDoc = docKey;
    }

    // Tab click handler
    document.querySelectorAll('.doc-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const docKey = tab.dataset.doc;
        if (docKey !== activeDoc) {
          loadDoc(docKey);
        }
      });
    });

    // Back to top button
    const backToTopBtn = document.getElementById('backToTop');
    window.addEventListener('scroll', () => {
      if (window.pageYOffset > 300) {
        backToTopBtn.style.display = 'flex';
      } else {
        backToTopBtn.style.display = 'none';
      }
    });

    backToTopBtn.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // Logout
    document.getElementById('logout-btn').addEventListener('click', async (e) => {
      e.preventDefault();
      await api.logout();
      window.location.href = '/pages/uqudo-sign-in';
    });

    // Load user info
    const user = api.getCurrentUser();
    if (user) {
      document.getElementById('user-name').textContent = user.fullName;
    }

    // Initialize - load the first doc
    loadDoc('api');
  </script>

  <!-- Theme Manager -->
  <script src="../assets/js/theme-manager.js"></script>
</body>
</html>
